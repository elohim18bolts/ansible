[Unit]
Description=Ansible pull service
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
ExecStart=/bin/sh -c 'truncate --size=0 {{ log_path }} && ansible-pull -U {{ repo_url }} {% if only_if_changed -%} --only-if-changed {%- endif %} --directory {{ repo_local_directory }}  -i $(uname -n), {{ playbook_path }}'
ExecStartPost=/bin/sh -c 'if [ -x "$(command -v mail)" ]; then cat {{ log_path }} | mail -s "${hostname} Maintenance Alert" {{ vault.recipient_email }};fi'
TimeoutStopSec=600

[Install]
WantedBy=basic.target
